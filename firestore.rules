rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      // Allow reads for any authenticated iliadmg.com user OR from our trusted server actions.
      allow read: if (request.auth != null &&
                      request.auth.token.email_verified &&
                      request.auth.token.email.matches('.*@iliadmg\\.com$')) ||
                     request.auth == null;

      // Allow writes (create, update, delete) for an authenticated iliadmg.com user
      // OR for any request from our trusted server actions.
      allow write: if (request.auth != null &&
                      request.auth.token.email_verified &&
                      request.auth.token.email.matches('.*@iliadmg\\.com$')) ||
                     request.auth == null;
    }
  }
}
